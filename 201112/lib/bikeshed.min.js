/*
Copyright Joyent, Inc. and other Node contributors.
Copyright 2011 uxebu Consulting Ltd. & Co. KG
Copyright 2011 David Aurelio <aurelio@uxebu.com>
Copyright 2011 Jens Arps <arps@uxebu.com>
Copyright 2011 Tobias Reiss <reiss@uxebu.com>
Copyright 2011 James Padolsey <padolsey@uxebu.com>
Copyright 2011 Stephan Seidt <seidt@uxebu.com>

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to permit
persons to whom the Software is furnished to do so, subject to the
following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
/*
 RequireJS 0.24.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var require,define;
(function(){function a(a){return"[object Function]"===i.call(a)}function j(a){return"[object Array]"===i.call(a)}function b(a,c,d){for(var m in c)if(!(m in F)&&(!(m in a)||d))a[m]=c[m];return l}function f(a,m,i){var b,f,g;for(b=0;g=m[b];b++){g="string"===typeof g?{name:g}:g;f=g.location;if(i&&(!f||0!==f.indexOf("/")&&-1===f.indexOf(":")))f=i+"/"+(f||g.name);a[g.name]={name:g.name,location:f||g.name,lib:g.lib||"lib",main:(g.main||"lib/main").replace(c,"").replace(d,"")}}}function h(c){function d(a){var c,m;
for(c=0;m=a[c];c++)if("."===m)a.splice(c,1),c-=1;else if(".."===m)if(1===c&&(".."===a[2]||".."===a[0]))break;else 0<c&&(a.splice(c-1,2),c-=2)}function m(a,c){var i,b;"."===a.charAt(0)&&c&&(G.pkgs[c]?c=[c]:(c=c.split("/"),c=c.slice(0,c.length-1)),a=c.concat(a.split("/")),d(a),b=G.pkgs[i=a[0]],a=a.join("/"),b&&a===i+"/"+b.main&&(a=i));return a}function i(a,c){var d=a?a.indexOf("!"):-1,b=null,f=c?c.name:null,g=a,e,h;-1!==d&&(b=a.substring(0,d),a=a.substring(d+1,a.length));b&&(b=m(b,f));a&&(e=b?(d=z[b])?
d.normalize?d.normalize(a,function(a){return m(a,f)}):m(a,f):"__$p"+f+"@"+a:m(a,f),h=K[e],h||(h=l.toModuleUrl?l.toModuleUrl(n,a,c):n.nameToUrl(a,null,c),K[e]=h));return{prefix:b,name:e,parentMap:c,url:h,originalName:g,fullName:b?b+"!"+e:e}}function g(){var a=!0,c=G.priorityWait,d,m;if(c){for(m=0;d=c[m];m++)if(!I[d]){a=!1;break}a&&delete G.priorityWait}return a}function h(a){return function(c){a.exports=c}}function e(c,d,m){return function(){var i=[].concat(v.call(arguments,0)),b;if(m&&a(b=i[i.length-
1]))b.__requireJsBuild=!0;i.push(d);return c.apply(null,i)}}function k(a,c){var d=e(n.require,a,c);b(d,{nameToUrl:e(n.nameToUrl,a),toUrl:e(n.toUrl,a),isDefined:e(n.isDefined,a),ready:l.ready,isBrowser:l.isBrowser});if(l.paths)d.paths=l.paths;return d}function t(a){var c=a.prefix,d=a.fullName;A[d]||d in z||(c&&!Q[c]&&(Q[c]=void 0,(U[c]||(U[c]=[])).push(a),(J[c]||(J[c]=[])).push({onDep:function(a){if(a===c){var d,m,b,f,g,e,h=U[c];if(h)for(b=0;d=h[b];b++)if(a=d.fullName,d=i(d.originalName,d.parentMap),
d=d.fullName,m=J[a]||[],f=J[d],d!==a){a in A&&(delete A[a],A[d]=!0);J[d]=f?f.concat(m):m;delete J[a];for(f=0;f<m.length;f++){e=m[f].depArray;for(g=0;g<e.length;g++)e[g]===a&&(e[g]=d)}}delete U[c]}}}),t(i(c))),n.paused.push(a))}function j(c){var d,m,i;d=c.callback;var b=c.fullName;i=[];var f=c.depArray;if(d&&a(d)){if(f)for(d=0;d<f.length;d++)i.push(c.deps[f[d]]);m=l.execCb(b,c.callback,i);if(b)if(c.usingExports&&void 0===m&&(!c.cjsModule||!("exports"in c.cjsModule)))m=z[b];else if(c.cjsModule&&"exports"in
c.cjsModule)m=z[b]=c.cjsModule.exports;else{if(b in z&&!c.usingExports)return l.onError(Error(b+" has already been defined"));z[b]=m}}else b&&(m=z[b]=d);if(b&&(i=J[b])){for(d=0;d<i.length;d++)i[d].onDep(b,m);delete J[b]}if(D[c.waitId])delete D[c.waitId],c.isDone=!0,n.waitCount-=1,0===n.waitCount&&(L=[])}function T(a,c,d,m){var a=i(a,m),b=a.name,f=a.fullName,g={},e={waitId:b||x+W++,depCount:0,depMax:0,prefix:a.prefix,name:b,fullName:f,deps:{},depArray:c,callback:d,onDep:function(a,c){a in e.deps||
(e.deps[a]=c,e.depCount+=1,e.depCount===e.depMax&&j(e))}},O,u;if(f){if(f in z||!0===I[f])return;A[f]=!0;I[f]=!0;n.jQueryDef="jquery"===f}for(d=0;d<c.length;d++)if(O=c[d])O=i(O,b?a:m),u=O.fullName,c[d]=u,"require"===u?e.deps[u]=k(a):"exports"===u?(e.deps[u]=z[f]={},e.usingExports=!0):"module"===u?(e.cjsModule=O=e.deps[u]={id:b,uri:b?n.nameToUrl(b,null,m):void 0},O.setExports=h(O)):u in z&&!(u in D)?e.deps[u]=z[u]:g[u]||(e.depMax+=1,t(O),(J[u]||(J[u]=[])).push(e),g[u]=!0);e.depCount===e.depMax?j(e):
(D[e.waitId]=e,L.push(e),n.waitCount+=1)}function u(a){T.apply(null,a);I[a[0]]=!0}function o(a){if(!n.jQuery&&(a=a||("undefined"!==typeof jQuery?jQuery:null))&&"readyWait"in a)if(n.jQuery=a,u(["jquery",[],function(){return jQuery}]),n.scriptCount)a.readyWait+=1,n.jQueryIncremented=!0}function w(a,c){if(!a.isDone){var d=a.fullName,m=a.depArray,b,i;if(d){if(c[d])return z[d];c[d]=!0}for(i=0;i<m.length;i++)if((b=m[i])&&!a.deps[b]&&D[b])a.onDep(b,w(D[b],c));return d?z[d]:void 0}}function V(){var a=1E3*
G.waitSeconds,c=a&&n.startTime+a<(new Date).getTime(),a="",d=!1,m=!1,b;if(!(0<n.pausedCount)){if(G.priorityWait)if(g())y();else return;for(b in I)if(!(b in F)&&(d=!0,!I[b]))if(c)a+=b+" ";else{m=!0;break}if(d||n.waitCount){if(c&&a)return b=Error("require.js load timeout for modules: "+a),b.requireType="timeout",b.requireModules=a,l.onError(b);if(m||n.scriptCount)(r||p)&&setTimeout(V,50);else if(n.waitCount){for(N=0;a=L[N];N++)w(a,{});V()}else l.checkReadyState()}}}function C(a,c){var d=c.name,b=c.fullName,
m;if(!(b in z||b in I))Q[a]||(Q[a]=z[a]),I[b]||(I[b]=!1),m=function(m){if(require.onPluginLoad)require.onPluginLoad(n,a,d,m);j({prefix:c.prefix,name:c.name,fullName:c.fullName,callback:function(){return m}});I[b]=!0},m.fromText=function(a,c){var d=M;n.loaded[a]=!1;n.scriptCount+=1;d&&(M=!1);eval(c);d&&(M=!0);n.completeLoad(a)},Q[a].load(d,k(c.parentMap,!0),m,G)}function E(a){a.prefix&&0===a.name.indexOf("__$p")&&z[a.prefix]&&(a=i(a.originalName,a.parentMap));var c=a.prefix,d=a.fullName;!A[d]&&!I[d]&&
(A[d]=!0,c?z[c]?C(c,a):(R[c]||(R[c]=[],(J[c]||(J[c]=[])).push({onDep:function(a){if(a===c){for(var d,b=R[c],a=0;a<b.length;a++)d=b[a],C(c,i(d.originalName,d.parentMap));delete R[c]}}})),R[c].push(a)):l.load(n,d,a.url))}var n,y,G={waitSeconds:7,baseUrl:s.baseUrl||"./",paths:{},pkgs:{}},B=[],A={require:!0,exports:!0,module:!0},K={},z={},I={},D={},L=[],W=0,J={},Q={},R={},S=0,U={};y=function(){var a,c,d;S+=1;if(0>=n.scriptCount)n.scriptCount=0;for(;B.length;){a=B.shift();if(null===a[0])return l.onError(Error("Mismatched anonymous require.def modules"));
u(a)}if(!G.priorityWait||g())for(;n.paused.length;){d=n.paused;n.pausedCount+=d.length;n.paused=[];for(c=0;a=d[c];c++)E(a);n.startTime=(new Date).getTime();n.pausedCount-=d.length}1===S&&V();S-=1};n={contextName:c,config:G,defQueue:B,waiting:D,waitCount:0,specified:A,loaded:I,urlMap:K,scriptCount:0,urlFetched:{},defined:z,paused:[],pausedCount:0,plugins:Q,managerCallbacks:J,makeModuleMap:i,normalize:m,configure:function(a){var c,d,m;a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+=
"/");c=G.paths;m=G.pkgs;b(G,a,!0);if(a.paths){for(d in a.paths)d in F||(c[d]=a.paths[d]);G.paths=c}if((c=a.packagePaths)||a.packages){if(c)for(d in c)d in F||f(m,c[d],d);a.packages&&f(m,a.packages);G.pkgs=m}if(a.priority)d=n.requireWait,n.requireWait=!1,n.takeGlobalQueue(),y(),n.require(a.priority),y(),n.requireWait=d,G.priorityWait=a.priority;if(a.deps||a.callback)n.require(a.deps||[],a.callback);a.ready&&l.ready(a.ready)},isDefined:function(a,c){return i(a,c).fullName in z},require:function(a,d,
m){if("string"===typeof a){if(l.get)return l.get(n,a,d);d=i(a,d);a=z[d.fullName];return void 0===a?l.onError(Error("require: module name '"+d.fullName+"' has not been loaded yet for context: "+c)):a}T(null,a,d,m);if(!n.requireWait)for(;!n.scriptCount&&n.paused.length;)y()},takeGlobalQueue:function(){H.length&&(P.apply(n.defQueue,[n.defQueue.length-1,0].concat(H)),H=[])},completeLoad:function(a){var c;for(n.takeGlobalQueue();B.length;)if(c=B.shift(),null===c[0]){c[0]=a;break}else if(c[0]===a)break;
else u(c),c=null;c?u(c):u([a,[],"jquery"===a&&"undefined"!==typeof jQuery?function(){return jQuery}:null]);I[a]=!0;o();l.isAsync&&(n.scriptCount-=1);y();l.isAsync||(n.scriptCount-=1)},toUrl:function(a,c){var d=a.lastIndexOf("."),m=null;-1!==d&&(m=a.substring(d,a.length),a=a.substring(0,d));return n.nameToUrl(a,m,c)},nameToUrl:function(a,c,b){var i,f,e,g,h=n.config;if(0===a.indexOf("./")||0===a.indexOf("../"))b=b&&b.url?b.url.split("/"):[],b.length&&b.pop(),b=b.concat(a.split("/")),d(b),c=b.join("/")+
(c?c:l.jsExtRegExp.test(a)?"":".js");else if(a=m(a,b),l.jsExtRegExp.test(a))c=a+(c?c:"");else{i=h.paths;f=h.pkgs;b=a.split("/");for(g=b.length;0<g;g--)if(e=b.slice(0,g).join("/"),i[e]){b.splice(0,g,i[e]);break}else if(e=f[e]){a=a===e.name?e.location+"/"+e.main:e.location+"/"+e.lib;b.splice(0,g,a);break}c=b.join("/")+(c||".js");c=("/"===c.charAt(0)||c.match(/^\w+:/)?"":h.baseUrl)+c}return h.urlArgs?c+((-1===c.indexOf("?")?"?":"&")+h.urlArgs):c}};n.jQueryCheck=o;n.resume=y;return n}function g(){var a,
c,d;if(B&&"interactive"===B.readyState)return B;a=document.getElementsByTagName("script");for(c=a.length-1;-1<c&&(d=a[c]);c--)if("interactive"===d.readyState)return B=d;return null}var k=/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/mg,e=/require\(["']([^'"\s]+)["']\)/g,c=/^\.\//,d=/\.js$/,i=Object.prototype.toString,t=Array.prototype,v=t.slice,P=t.splice,r=!!("undefined"!==typeof window&&navigator&&document),p=!r&&"undefined"!==typeof importScripts,o=r&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,
w="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),x="_r@@",F={},C={},H=[],B=null,M=!1,l,t={},A,s,E,K,y,D,L,N,m,T,u;if("undefined"!==typeof require){if(a(require))return;t=require}l=require=function(a,c,d){var b="_",m;!j(a)&&"string"!==typeof a&&(m=a,j(c)?(a=c,c=d):a=[]);if(m&&m.context)b=m.context;d=C[b]||(C[b]=h(b));m&&d.configure(m);return d.require(a,c)};l.version="0.24.0";l.isArray=j;l.isFunction=a;l.mixin=b;l.jsExtRegExp=/^\/|:|\?|\.js$/;s=l.s={contexts:C,skipAsync:{},isPageLoaded:!r,
readyCalls:[]};if(l.isAsync=l.isBrowser=r)if(E=s.head=document.getElementsByTagName("head")[0],K=document.getElementsByTagName("base")[0])E=s.head=K.parentNode;l.onError=function(a){throw a;};l.load=function(a,c,d){var b=a.contextName,m=a.urlFetched,i=a.loaded;i[c]||(i[c]=!1);if(!m[d]&&(a.scriptCount+=1,l.attach(d,b,c),m[d]=!0,a.jQuery&&!a.jQueryIncremented))a.jQuery.readyWait+=1,a.jQueryIncremented=!0};define=l.def=function(a,c,d){var b;"string"!==typeof a&&(d=c,c=a,a=null);l.isArray(c)||(d=c,c=
[]);!a&&!c.length&&l.isFunction(d)&&d.length&&(d.toString().replace(k,"").replace(e,function(a,d){c.push(d)}),c=["require","exports","module"].concat(c));if(M){b=A||g();if(!b)return l.onError(Error("ERROR: No matching script interactive for "+d));a||(a=b.getAttribute("data-requiremodule"));b=C[b.getAttribute("data-requirecontext")]}(b?b.defQueue:H).push([a,c,d])};define.amd={multiversion:!0,plugins:!0};l.execCb=function(a,c,d){return c.apply(null,d)};l.onScriptLoad=function(a){var c=a.currentTarget||
a.srcElement,d;if("load"===a.type||o.test(c.readyState))B=null,a=c.getAttribute("data-requirecontext"),d=c.getAttribute("data-requiremodule"),C[a].completeLoad(d),c.detachEvent&&!w?c.detachEvent("onreadystatechange",l.onScriptLoad):c.removeEventListener("load",l.onScriptLoad,!1)};l.attach=function(a,c,d,b,m){var i;if(r)return b=b||l.onScriptLoad,i=document.createElement("script"),i.type=m||"text/javascript",i.charset="utf-8",i.async=!s.skipAsync[a],i.setAttribute("data-requirecontext",c),i.setAttribute("data-requiremodule",
d),i.attachEvent&&!w?(M=!0,i.attachEvent("onreadystatechange",b)):i.addEventListener("load",b,!1),i.src=a,A=i,K?E.insertBefore(i,K):E.appendChild(i),A=null,i;if(p)b=C[c],c=b.loaded,c[d]=!1,importScripts(a),b.completeLoad(d);return null};if(r){y=document.getElementsByTagName("script");for(N=y.length-1;-1<N&&(D=y[N]);N--){if(!E)E=D.parentNode;if(L=D.getAttribute("data-main")){if(!t.baseUrl)y=L.split("/"),D=y.pop(),y=y.length?y.join("/")+"/":"./",t.baseUrl=y,L=D.replace(d,"");t.deps=t.deps?t.deps.concat(L):
[L];break}}}s.baseUrl=t.baseUrl;l.pageLoaded=function(){if(!s.isPageLoaded){s.isPageLoaded=!0;m&&clearInterval(m);if(T)document.readyState="complete";l.callReady()}};l.checkReadyState=function(){var a=s.contexts,c;for(c in a)if(!(c in F)&&a[c].waitCount)return;s.isDone=!0;l.callReady()};l.callReady=function(){var a=s.readyCalls,c,d,b;if(s.isPageLoaded&&s.isDone){if(a.length){s.readyCalls=[];for(c=0;d=a[c];c++)d()}a=s.contexts;for(b in a)if(!(b in F)&&(c=a[b],c.jQueryIncremented))c.jQuery.ready(!0),
c.jQueryIncremented=!1}};l.ready=function(a){s.isPageLoaded&&s.isDone?a():s.readyCalls.push(a);return l};if(r){if(document.addEventListener){if(document.addEventListener("DOMContentLoaded",l.pageLoaded,!1),window.addEventListener("load",l.pageLoaded,!1),!document.readyState)T=!0,document.readyState="loading"}else window.attachEvent&&(window.attachEvent("onload",l.pageLoaded),self===self.top&&(m=setInterval(function(){try{document.body&&(document.documentElement.doScroll("left"),l.pageLoaded())}catch(a){}},
30)));"complete"===document.readyState&&l.pageLoaded()}l(t);if(l.isAsync&&"undefined"!==typeof setTimeout)u=s.contexts[t.context||"_"],u.requireWait=!0,setTimeout(function(){u.requireWait=!1;u.takeGlobalQueue();u.jQueryCheck();u.scriptCount||u.resume();l.checkReadyState()},0)})();define("requireLib",function(){});
define("event_emitter",[],function(){var a;a={addListener:function(a,b){if("function"!==typeof b)throw Error("addListener only takes instances of Function");var f=this._events||(this._events=Object.create(null)),h=f[a],g,k;if(h){k=b.listener||b;for(f=0;g=h[f];f++)if(k===g||k===g.listener)return this;h.push(b)}else f[a]=[b];return this},emit:function(a,b,f){var h,g,k,e;k=this._events;if("error"===a&&(!k||!k.error||!k.error.length)){if(b instanceof Error)throw b;throw Error("Uncaught, unspecified \u201cerror\u201d event.");
}if(!k)return!1;if(k=k[a]){k=k.slice();g=arguments.length;switch(g){case 1:break;case 2:h=[b];break;case 3:h=[b,f];break;default:h=[];for(e=1;e<g;e++)h[e-1]=arguments[e]}for(e=0;g=k[e];e++)g.apply(this,h)}return this},listeners:function(a){var b=this._events||(this._events=Object.create(null));return b[a]||(b[a]=[])},once:function(a,b){if("function"!==typeof b)throw Error("once only takes instances of Function");var f=function(){this.removeListener(a,f);b.apply(this,arguments)};f.listener=b;return this.on(a,
f)},removeAllListeners:function(a){var b=this._events;0===arguments.length?delete this._events:b&&delete b[a];return this},removeListener:function(a,b){if("function"!==typeof b)throw Error("removeListener only takes instances of Function");var f,h,g=(f=this._events)&&f[a];if(f&&g)for(f=0;h=g[f];f++)if(b===h||b===h.listener){g.splice(f,1);break}return this}};a.on=a.addListener;return a});
define("tools",[],function(){return{descriptorAccessor:function(a,j,b,f){return{get:a,set:j,enumerable:!!b,configurable:!!f}},descriptorData:function(a,j,b,f){return{value:a,writable:!!j,enumerable:!!b,configurable:!!f}},getter:function(a){return function(){return this[a]}},mixin:function(a,j){var b,f,h,g,k=2,e=Object.keys;do if(j){g=e(j);for(b=0,f=g.length;b<f;b++)h=g[b],a[h]=j[h]}while(j=arguments[k++]);return a},hitch:function(a,j){j||(j=a,a=null);if("string"===typeof j){a=a||window;if(!a[j])throw["method not found"];
return function(){return a[j].apply(a,arguments||[])}}return!a?j:function(){return j.apply(a,arguments||[])}},toArray:function(a,j,b){return(b||[]).concat(Array.prototype.slice.call(a,j||0))}}});
define("timeline",["event_emitter","tools"],function(a,j){var b=Math.round;return j.mixin({currentFrame:0,isPlaying:!0,advance:function(){var a=this.currentFrame;this.emit("tick",this,a);if(this.isPlaying){this.emit("advance",this,a);this.emit(a,this,a);var b=this.length(),b=this.currentFrame=(a+1)%b||0;0===b&&b!==a&&"function"===typeof this.children&&this.children([])}},frames:function(a){var b,g,k=0;for(g in a)b=+g,b!=g&&(b=this.toFrameNumber(g)),b>k&&(k=b),this.on(b,a[g]);if(k>this.length())this._length=
k+1;return this},length:function(a){var b=this._length||(this._length=0);if(0===arguments.length)return b;for(a*=1;b-- >=a;)this.removeAllListeners(b);this._length=a;return this},play:function(a){a*=1;this.isPlaying=!0;if(0<=a&&a<this.length())this.currentFrame=a,this.emit(a,this,a);return this},stop:function(a){a*=1;this.isPlaying=!1;if(0<=a&&a<this.length())this.currentFrame=a,this.emit(a,this,a);return this},toFrameNumber:function(a){if(a==+a)return+a;a=(""+a).split(/([^\d.]+)/);switch(a[1]){case "ms":a[0]/=
1E3;case "s":return b(a[0]*(this.framerate||bikeshed.stage.framerate));case "%":return b(this._length*a[0]/100)||0;default:throw Error("Unknown frame format: "+a[1]);}}},a)});define("registry",[],function(){return{displayObjects:Object.create(null),loadingDisplayObjects:Object.create(null),movies:Object.create(null),needsDraw:Object.create(null)}});
define("display_list",["./registry"],function(a){var j;j={isVisible:!1,addChild:function(b,f){b.parent=this;b.isVisible=this.isVisible;a.displayObjects[b.id]=b;"function"===typeof b.advance&&(a.movies[b.id]=b);"undefined"!==typeof f?this._children.splice(f,0,b):this._children.push(b);this.isVisible&&b.markUpdate();return b},children:function(a){if(!a)return this._children.slice(0);a.forEach(function(a){this.add(a)},this);return this},clear:function(){this._children.slice(0).map(this.remove,this);
return this},getIndexOfChild:function(a){return this._children.indexOf(a)},removeChild:function(b){var f=this._children,h=f.indexOf(b);-1!==h&&(delete a.displayObjects[b.id],delete a.movies[b.id],delete a.needsDraw[b.id],f.splice(h,1));return this}};j.add=j.addChild;return j});
define("stage",["./event_emitter","./display_list","./timeline","./tools","./registry"],function(a,j,b,f,h){var g=h.movies,k={init:function(a){this.options=a;a=Math.abs(a.framerate|0)||30;setInterval(k.loop,1E3/a);Object.defineProperty(this,"framerate",{value:a})},handleEvent:function(a){if("message"===a.type){var c=a.data,a=c.command,c=c.data;switch(a){case "play":case "stop":this[a](c);break;case "assetLoaded":if(c.id in h.loadingDisplayObjects)h.loadingDisplayObjects[c.id].emit("assetLoaded",c);
else throw Error("Couldn't fine id: "+c.id+" in `loadingDisplayObjects`");break;case "userevent":(c.id?h.displayObjects[c.id]:this).emit(c.type,c.args)}}},loop:function(){k.advance();for(var a in g)g[a].advance();var c=[],d;for(d in h.needsDraw){delete h.needsDraw[d];var b=h.displayObjects[d];a={id:d};if(b){if(!b.composeRenderMessage)continue;f.mixin(a,b.composeRenderMessage())}c.push(a)}c.length&&postMessage({command:"render",data:c,frame:k.currentFrame})}};Object.defineProperty(k,"id",{value:0});
f.mixin(k,a,j,b);k.isVisible=!0;k._children=[];return k});
define("point",[],function(){var a,j=Math.sqrt;a=function(a,b){this.x=a||0;this.y=b||0};var b=a.prototype;b.add=function(a){this.x+=a.x;this.y+=a.y;return this};b.equals=function(a){return this.x===a.x&&this.y===a.y};b.clone=function(){return new a(this.x,this.y)};b.normalize=function(a){j(this.x*this.x+this.y*this.y);a/=this.length;this.x*=a;this.y*=a;return this};b.offset=function(a,b){this.x+=a;this.y+=b;return this};b.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};b.toString=function(){return this.x+
","+this.y+" "};b.toObject=function(){return Object.create(null,{x:{value:this.x},y:{value:this.y}})};b.toArray=function(){return[this.x,this.y]};b.distance=function(a){var b=this.x-a.x,a=this.y-a.y;return j(b*b+a*a)};a.interpolate=function(b,h,g){return new a(b.x+g*(b.x-h.x),b.y+g*(b.y-h.y))};a.polar=function(b,h){return new a(b*Math.cos(h),b*Math.sin(h))};return a});define("curve",["./tools"],function(){return function(a,j){this._segment1=a;this._segment2=j;return this}});
define("error",[],function(){function a(a){this.name="ParserError";this.message=a[0]}a.prototype=Error();a.prototype.constructor=a;return{ParserError:a}});
define("segment_helper",["./point","./error"],function(a,j){function b(a,d){var b=[],g=!0,e=[],h,k,p,o,w=a&&a.length||0,x,F,d=d||f;if(0===w)return[];for(o=0;o<w;o++)if(p=a[o],g){b=[];if(!d[p])throw new j.ParserError(['Unknown command: "'+p+'"']);b.push(p);h=p;k=d[p].attributes.slice(0);(g=!k.length)&&e.push(b)}else{F=k.shift();x=+p;switch(F){case "B":if(0!==x&&1!==x)throw new j.ParserError(['Invalid parameter for command "'+h+'", expected 0 or 1 but got "'+p+'".']);b.push(x);break;case "N":if(isNaN(x))throw new j.ParserError(['Invalid parameter for command "'+
h+'", expected numeric but got "'+p+'".']);b.push(x);break;case "P":if(isNaN(x))throw new j.ParserError(['Could not create Point from String                 for command "'+h+'", expected numeric but got                 "'+p+'".']);b.push(x);x=+a[++o];if(isNaN(x))throw new j.ParserError(['Could not create Point from String                  for command "'+h+'", expected numeric but got                  "'+a[o]+'".']);b.push(x)}k.length||(g=!0,e.push(b))}return e}var f={moveTo:{attributes:["P"],shorthands:["M"]},
moveBy:{attributes:["P"],shorthands:["m"]},closePath:{attributes:[],shorthands:["Z","z"]},lineTo:{attributes:["P"],shorthands:["L"]},lineBy:{attributes:["P"],shorthands:["l"]},verticalLineTo:{attributes:["N"],shorthands:["V"],convertTo:"lineTo"},verticalLineBy:{attributes:["N"],shorthands:["v"],convertTo:"lineBy"},horizontalLineTo:{attributes:["N"],shorthands:["H"],convertTo:"lineTo"},horizontalLineBy:{attributes:["N"],shorthands:["h"],convertTo:"lineBy"},arcTo:{attributes:["P","N","B","B","P"],shorthands:["A"]},
arcBy:{attributes:["P","N","B","B","P"],shorthands:["a"]},curveTo:{attributes:["P","P","P"],shorthands:["C"]},curveBy:{attributes:["P","P","P"],shorthands:["c"]},throughCurveTo:{attributes:["P","P"],shorthands:["TC"]},throughCurveBy:{attributes:["P","P"],shorthands:["tc"]},quadraticCurveTo:{attributes:["P","P"],shorthands:["Q"]},quadraticCurveBy:{attributes:["P","P"],shorthands:["q"]},smoothCurveTo:{attributes:["P","P"],shorthands:["S"]},smoothCurveBy:{attributes:["P","P"],shorthands:["s"]},smoothQuadraticCurveTo:{attributes:["P"],
shorthands:["T"]},smoothQuadraticCurveBy:{attributes:["P"],shorthands:["t"]}},h=Object.create(null),g;for(g in f)f[g].shorthands.forEach(function(a){h[a]=g});var k=Object.create(null);for(g in f)k[g]=f[g].shorthands[0];var e=[];for(g in f)e.push(g),e=e.concat(f[g].shorthands);return{validTokens:e,parsePath:function(a){var d=[];a.replace(/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,function(a,c,b){d.push(h[c]);b.replace(/(-?\d*\.?\d*(?:e[\-+]?\d+)?)\s*,?\s*/ig,function(a,c){c&&d.push(c)})});
return b(d)},exportToPath:function(a){return a.map(function(a){return a.map(function(a){return"string"===typeof a?k[a]:a}).join(" ")}).join(" ")},parseCommandList:b}});define("asset_loading",["./registry"],function(a){return{load:function(j,b){a.loadingDisplayObjects[this.id]=this;this.once("assetLoaded",function(){delete a.loadingDisplayObjects[this.id]});postMessage({command:"loadAsset",data:{type:b,id:this.id,source:j}});return this}}});
define("easing",{linear:function(a){return a},quadIn:function(a){return Math.pow(a,2)},quadOut:function(a){return-1*a*(a-2)},quadInOut:function(a){a*=2;return 1>a?Math.pow(a,2)/2:-1*(--a*(a-2)-1)/2},cubicIn:function(a){return Math.pow(a,3)},cubicOut:function(a){return Math.pow(a-1,3)+1},cubicInOut:function(a){a*=2;return 1>a?Math.pow(a,3)/2:(Math.pow(a-2,3)+2)/2},quartIn:function(a){return Math.pow(a,4)},quartOut:function(a){return-1*(Math.pow(a-1,4)-1)},quartInOut:function(a){a*=2;return 1>a?Math.pow(a,
4)/2:-0.5*(Math.pow(a-2,4)-2)},quintIn:function(a){return Math.pow(a,5)},quintOut:function(a){return Math.pow(a-1,5)+1},quintInOut:function(a){a*=2;return 1>a?Math.pow(a,5)/2:(Math.pow(a-2,5)+2)/2},sineIn:function(a){return-1*Math.cos(a*(Math.PI/2))+1},sineOut:function(a){return Math.sin(a*(Math.PI/2))},sineInOut:function(a){return-1*(Math.cos(Math.PI*a)-1)/2},expoIn:function(a){return 0===a?0:Math.pow(2,10*(a-1))},expoOut:function(a){return 1===a?1:-1*Math.pow(2,-10*a)+1},expoInOut:function(a){if(0===
a)return 0;if(1===a)return 1;a*=2;if(1>a)return Math.pow(2,10*(a-1))/2;--a;return(-1*Math.pow(2,-10*a)+2)/2},circIn:function(a){return-1*(Math.sqrt(1-Math.pow(a,2))-1)},circOut:function(a){return Math.sqrt(1-Math.pow(a-1,2))},circInOut:function(a){a*=2;return 1>a?-0.5*(Math.sqrt(1-Math.pow(a,2))-1):0.5*(Math.sqrt(1-Math.pow(a-2,2))+1)},backIn:function(a){return Math.pow(a,2)*(2.70158*a-1.70158)},backOut:function(a){a-=1;return Math.pow(a,2)*(2.70158*a+1.70158)+1},backInOut:function(a){a*=2;if(1>a)return Math.pow(a,
2)*(3.5949095*a-2.5949095)/2;a-=2;return(Math.pow(a,2)*(3.5949095*a+2.5949095)+2)/2},elasticIn:function(a){if(0===a||1===a)return a;a-=1;return-1*Math.pow(2,10*a)*Math.sin((a-0.075)*2*Math.PI/0.3)},elasticOut:function(a){return 0===a||1===a?a:Math.pow(2,-10*a)*Math.sin((a-0.075)*2*Math.PI/0.3)+1},elasticInOut:function(a){if(0===a)return 0;a*=2;if(2===a)return 1;var j=0.3*1.5,b=j/4;if(1>a)return a-=1,-0.5*Math.pow(2,10*a)*Math.sin((a-b)*2*Math.PI/j);a-=1;return 0.5*Math.pow(2,-10*a)*Math.sin((a-b)*
2*Math.PI/j)+1},bounceIn:function(a){return 1-easingFuncs.bounceOut(1-a)},bounceOut:function(a){return a=a<1/2.75?7.5625*Math.pow(a,2):a<2/2.75?7.5625*Math.pow(a-1.5/2.75,2)+0.75:a<2.5/2.75?7.5625*Math.pow(a-2.25/2.75,2)+0.9375:7.5625*Math.pow(a-2.625/2.75,2)+0.984375},bounceInOut:function(a){return 0.5>a?easingFuncs.bounceIn(2*a)/2:easingFuncs.bounceOut(2*a-1)/2+0.5}});
define("matrix",["point"],function(a){function j(a,b,k,e,c,d){this.a=null!==a&&void 0!==a?a:1;this.b=b||0;this.c=k||0;this.d=null!==e&&void 0!==e?e:1;this.tx=c||0;this.ty=d||0}var b=Math.cos,f=Math.sin;j.prototype={clone:function(){return new j(this.a,this.b,this.c,this.d,this.tx,this.ty)},concat:function(a){var b=this.a,k=this.b,e=this.c,c=this.d,d=this.tx,i=this.ty;this.a=b*a.a+k*a.c;this.b=b*a.b+k*a.d;this.c=e*a.a+c*a.c;this.d=e*a.b+c*a.d;this.tx=d*a.a+i*a.c+a.tx;this.ty=d*a.b+i*a.d+a.ty;return this},
createBox:function(a,b,k,e,c){return this.identify().rotate(k).scale(a,b).translate(e,c)},deltaTransformPoint:function(b){return new a(this.a*b.x+this.c*b.y,this.b*b.x+this.d*b.y)},identify:function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this},invert:function(){var a=this.a*this.d-this.b*this.c,b=this.a,k=this.b,e=this.c,c=this.d,d=this.tx,i=this.ty;this.a=c/a;this.b=-k/a;this.c=-e/a;this.d=b/a;this.tx=(e*i-c*d)/a;this.ty=(k*d-b*i)/a;return this},rotate:function(a){var g=b(a),a=
f(a);return this.concat(new j(g,a,-a,g,0,0))},scale:function(a,b){this.a*=a;this.b*=b;this.c*=a;this.d*=b;this.tx*=a;this.ty*=b;return this},transformPoint:function(b){return new a(this.a*b.x+this.c*b.y+this.tx,this.b*b.x+this.d*b.y+this.ty)},translate:function(a,b){this.tx+=a;this.ty+=b;return this}};return j});
define("color_map",[],function(){var a={aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,
darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,
fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,
lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,
mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,red:4278190335,
rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,transparent:0,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,
yellowgreen:2597139199};Object.defineProperty(a,"random",{get:function(){return 16777215*Math.random()<<8|255}});return a});
define("color",["./tools","./color_map"],function(a,j){function b(a,d){a=b.parse(a,d);return((a.r&255)<<24|(a.g&255)<<16|(a.b&255)<<8|255*a.a&255)>>>0}function f(c,b,i,g){function k(c){return a.descriptorAccessor(function(){return this.get(c)},function(a){return this.set(c,a)},!0)}this._properties={r:e(c||0),g:e(b||0),b:e(i||0),a:g||1};Object.defineProperties(this,{r:k("r"),g:k("g"),b:k("b"),a:k("a"),h:k("h"),s:k("s"),l:k("l"),red:k("r"),green:k("g"),blue:k("b"),alpha:k("a"),hue:k("h"),saturation:k("s"),
lightness:k("l")})}function h(a,b,i){i=0>i?i+1:1<i?i-1:i;return 1>6*i?a+6*(b-a)*i:1>2*i?b:2>3*i?a+6*(b-a)*(2/3-i):a}function g(a,b,i){var b=0.5>=i?i*(b+1):i+b-i*b,e=2*i-b,i=255*h(e,b,a+1/3),g=255*h(e,b,a),a=255*h(e,b,a-1/3);return{r:i,g:g,b:a}}function k(a,b,i){var a=a/255,b=b/255,i=i/255,e=Math.max(a,b,i),g=Math.min(a,b,i),k,f,h;f=(g+e)/2;if(e===g)k=g=0;else{h=e-g;g=0.5<f?h/(2-e-g):h/(e+g);switch(e){case a:k=(b-i)/h+(b<i?6:0);break;case b:k=(i-a)/h+2;break;case i:k=(a-b)/h+4}k/=6}return{h:k,s:g,
l:f}}var e=Math.round;b.RGBAColor=f;f.prototype.set=function(a,b){var i,e=this._properties;switch(a){case "r":case "g":case "b":case "a":e[a]=b;break;case "h":case "s":case "l":i=k(e.r,e.g,e.b);b=Math.min(1,Math.max(0,b));i[a]=b;i=g(i.h,i.s,i.l);e.r=i.r;e.g=i.g;e.b=i.b;break;default:throw Error("No support for setting: "+a);}};f.prototype.get=function(a){var b;b=this._properties;switch(a){case "r":case "g":case "b":return e(b[a]);case "a":return b[a];case "h":case "s":case "l":return b=k(b.r,b.g,
b.b),b[a];default:throw Error("No support for getting: "+a);}};f.prototype.clone=function(){return b.parse(""+this)};f.prototype.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a].join()+")"};f.prototype.midpoint=function(a){a=b.parse(a);return new f((this.r+a.r)/2,(this.g+a.g)/2,(this.b+a.b)/2,(this.a+a.a)/2)};f.prototype.randomSimilar=function(){var a=Math.max(this.r,this.g,this.b),d=Math.min(this.r,this.g,this.b),i=100*((a-d)/a),a=(a+d)/2;return b.parse("hsla("+[0|360*Math.random(),
(0|Math.min(100,20*Math.random()+i-10))+"%",(0|100*(Math.min(255,20*Math.random()+a-10)/255))+"%",Math.min(1,Math.max(0,0.1*Math.random()+this.a-0.05))].join()+")")};b.parse=function(a,b){var i,e,a=""+a;a in j&&(a=j[a]);/^#[0-9a-f]{6}$/i.test(a)&&(a=(parseInt(a.slice(1),16)<<8|255)>>>0);if(/^#[0-9a-f]{3}$/i.test(a))var a=parseInt(a.slice(1),16),k=a&3840,h=a&240,r=a&15,a=(k<<20|k<<16|h<<16|h<<12|r<<12|r<<8|255)>>>0;if(+a)return new f(a>>24&255,a>>16&255,a>>8&255,(a>>0&255)/255);a=(""+a).split("(");
if(2===a.length)switch(a[0]){case "rgb":i=/\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,e=1;case "rgba":i||(i=/\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(0|1|[01]?(?:\.\d+))\s*\)$/);if(i=i.exec(a[1]))return new f(i[1],i[2],i[3],e||i[4]);break;case "hsl":i=/\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)$/,e=1;case "hsla":if(i||(i=/\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(0|1|[01]?(?:\.\d+))\s*\)$/),i=i.exec(a[1]))return a=g(i[1]%360/360,i[2]/100,i[3]/100),a.a=e||i[4],new f(a.r,a.g,a.b,a.a)}return null==b?{r:0,g:0,
b:0,a:1}:b};return b});
define("animation",["./easing","./timeline","./tools","./event_emitter","./color"],function(a,j,b,f,h){function g(a){return{setup:function(){var b=h.parse(this[a]);this[a+"_r"]=b.r;this[a+"_g"]=b.g;this[a+"_b"]=b.b;this[a+"_a"]=b.a;delete this[a]},step:function(){this[a]=""+new h.RGBAColor(this[a+"_r"],this[a+"_g"],this[a+"_b"],this[a+"_a"])}}}function k(b,c,e){e=this.options=e||{};this._parseEventProps(e);var g=e.easing;this.easing=g instanceof Function?g:a[g];this.clock=e.clock||bikeshed.stage;
this.duration=+b||this.clock.toFrameNumber(b);this.repeat=e.repeat-(e.repeat%1||0);this._bind();this.delay=e.delay||0;this.properties=c;this.propertyNames=Object.keys(c);this.startValues=0;this.translations=e.translate?[e.translate]:[];this._getTranslations();this._runTranslations(c,"setup");this.propertyNames=Object.keys(c)}var e=b.mixin,c=k.propertyTranslations={fill:g("fill"),line:g("line")};k.prototype={_bind:function(){var a=this,b=this.clock,c=this.options;"from"in c?(Object.defineProperty(this,
"isTimelineBound",{value:!0}),this.from=+c.from||b.toFrameNumber(c.from),this.onStep=function(b,c){var e=a.from,i=a.duration,g=e+i;if(c>=e||c<=g||c>=e||c<=g)e=(c-e)/i,a.step(1<e?1:0>e?0:e)},b.on("advance",this.onStep)):(this.frame=0,this.onStep=function(){var b=a.duration,c=++a.frame;a.step(c/b);c===b&&(a.reset(),0<a.repeat--&&a.play())},c.subject&&this.setSubject(c.subject,c.strategy))},_getTranslations:function(){for(var a=this.propertyNames,b,e=0,g=a.length;e<g;e++)if(a[e]in c){b=c[a[e]];if(!(b.step instanceof
Function&&b.setup instanceof Function))throw Error("Translations must implement setup and step methods");this.translations.push(b)}},_runTranslations:function(a,b){for(var c=this.translations.length;c--;)this.translations[c][b].call(a,a)},play:function(a,b){if(this.isTimelineBound)return this;a&&this.setSubject(a,b);if(!this.subject)throw Error("play() cannot run without a subject");this.clock.on("tick",this.onStep);0===this.frame&&this.emit("beforebegin",this.subject,this);this.emit("play",this.subject,
this);this.isPlaying=!0;return this},pause:function(){if(this.isTimelineBound)return this;this.clock.removeListener("tick",this.onStep);this.emit("pause",this.subject,this);this.isPlaying=!1},clone:function(){var a={clock:this.clock,duration:this.duration,easing:this.easing};if("from"in this)a.from=this.from;return new k(this.duration,e({},this.properties),a)},_parseEventProps:function(a){var b,c;for(b in a)0===b.indexOf("on")&&(c=b.substring(2).toLowerCase(),this.on(c,a[b]),delete a[b])},reset:function(){if(this.isTimelineBound)return this;
this.frame=0;this.isPlaying=!1;this.clock.removeListener("tick",this.onStep);return this},setSubject:function(a,b){this.strategy=b||(b="attr");this.subject=a;var c,e=this.propertyNames;switch(b){case "attr":c=a.attr();break;case "prop":c={};for(var g=0,k;k=e[g++];)c[k]=a[k];break;default:c=b.get(a,this.propertyNames)}this._runTranslations(c,"setup");this.initialValues=c;return this},step:function(a){var b,c,e,g,k;b=this.easing;var f=this.properties,h=this.initialValues,j=this.propertyNames,x=this.strategy,
F="prop"===x,C=this.subject,H={};b&&(a=b(a));for(c=0,g=j.length;c<g;c++)e=j[c],b=h[e],k=f[e],H[e]=b+(k-b)*a;this._runTranslations(H,"step");if("attr"===x)C.attr(H);else if(F)for(c=0;c<g;c++)e=j[c],C[e]=H[e];else x.set(C,H);1===a&&this.emit("end",this.subject,this);return this}};e(k.prototype,f);return k});
define("keyframe_animation",["./animation","./easing","./tools","./event_emitter"],function(a,j,b,f){function h(a,b,c){c||(c={});var d=this.clock=c.clock||bikeshed.stage,a=this.duration=+a||d.toFrameNumber(a);this.animations=[];this.currentAnimation=-1;this.repeat=c.repeat||0;this.keyframes=this._convertKeysToFrames(b);this.keys=Object.keys(this.keyframes).map(Number);this.keys.sort(function(a,b){return a-b});this._fillInProperties();this._createAnimations();c.subject&&this.setSubject(c.subject,c.strategy)}
var g={}.hasOwnProperty;h.prototype={play:function(a,b){a&&this.setSubject(a,b);if(0>this.currentAnimation)this.begin();else return this.animations[this.currentAnimation].isPlaying=!0,this},pause:function(){if(-1<this.currentAnimation)this.animations[this.currentAnimation].isPlaying=!1;return this},reset:function(){this.animations.forEach(function(a){a.reset()});this.currentAnimation=-1;return this},begin:function(){var a=this.keyframes[0],b=this.subject,c=this.strategy;if(a&&b)switch(c){case "attr":b.attr(a);
break;case "prop":for(var d in a)b[d]=a[d];break;default:c.set(b,a)}this.currentAnimation=0;this.animations[0].play(b,c);return this},setSubject:function(a,b){this.strategy=b||"attr";this.subject=a;return this},_createAnimations:function(){var g,e=0,c,d=this.animations,i=this.keyframes;this.keys.forEach(function(f,h){var j;if(0!==f){g=f-e;e+=g;j=new a(g,i[f],{easing:this.easing,clock:this.clock,subject:this.subject,strategy:this.strategy});if(c)c.on("end",b.hitch(this,function(){this.currentAnimation++;
j.play(this.subject,this.strategy)}));d.push(j);c=j;if(h===this.keys.length-1)j.on("end",b.hitch(this,function(){0<this.repeat?(this.repeat--,this.reset(),this.play()):this.emit("end")}))}},this)},_fillInProperties:function(){var a=this.duration,b=this.keys,c=this.keyframes,d,i={};b.forEach(function(a){d=c[a];for(var b in d)d.hasOwnProperty(b)&&(i[b]=!0)});b.forEach(function(f,h){var j,r,p,o,w;d=c[f];for(w in i)if(!g.call(d,w)){a:{j=w;for(r=h;r--;)if(g.call(c[b[r]],j)){j=b[r];break a}j=null}a:{r=
w;p=h;for(o=b.length;p<o;++p)if(g.call(c[b[p]],r)){r=b[p];break a}r=null}p=j&&c[j][w];o=r&&c[r][w];if(null===p||void 0===p)throw Error("No initial value specified for property: "+w);if(null===o||void 0===o)o=p,r=a;d[w]=o*(f-j)/(r-j)}})},_convertKeysToFrames:function(a){for(var b,c,d=0,g=this.clock,f=this.duration,h=Object.keys(a),j=Object.create(null),r=0,p=h.length;r<p;r++)b=h[r],c=b==+b?b:"from"===b?0:"to"===b?f:/^\d+%$/.test(b)?f*parseFloat(b)/100:g.toFrameNumber(b),j[c]=a[b],c>d&&(d=c);if(d>this.duration)this.duration=
d;return j}};b.mixin(h.prototype,f);return h});
define("display_object","./event_emitter,./tools,./registry,./matrix,./point,./animation,./keyframe_animation".split(","),function(a,j,b,f,h,g,k){function e(){var a=this._matrix,b=K(a.b,a.a),a=-K(a.c,a.d);return b>a?b:a}function c(a){var a=+a%(2*D)||0,b=this._matrix,c=b.tx,d=b.ty,e;e=b.deltaTransformPoint(this.origin);b.tx=-e.x;b.ty=-e.y;b.rotate(a-this.rotation);b.tx+=e.x+c;b.ty+=e.y+d}function d(){return this._matrix.clone()}function i(a){var b=this._matrix;b.a=a.a;b.b=a.b;b.c=a.c;b.d=a.d;b.tx=
a.tx;b.ty=a.ty}function t(){return this._matrix.tx}function v(a){this._matrix.tx=a}function P(){return this._matrix.ty}function r(a){this._matrix.ty=a}function p(){var a=this._matrix;return y(a.a*a.a+a.b*a.b)}function o(a){var b=this._matrix;if((a*=1)||0===a){var c=b.tx,d=this.scaleX,e=this.origin.x*d;b.tx=-e;b.scale(a/d,1);b.tx+=c+e}}function w(){var a=this._matrix;return y(a.d*a.d+a.c*a.c)}function x(a){var b=this._matrix;if((a*=1)||0===a){var c=b.ty,d=this.scaleY,e=this.origin.y*d;b.ty=-e;b.scale(1,
a/d);b.ty+=c+e}}function F(a){this.scaleX=this.scaleY=a}function C(a){this._opacity=1<a?1:0>a?0:+a}function H(){return this._origin.clone()}function B(a){var b=this._origin;b.x=a.x;b.y=a.y}function M(){Object.defineProperty(this,"id",{value:E++});this._attributes=Object.create(null,{_matrix:A(new f),matrix:l(d,i,!0),_opacity:A(1,!0),opacity:l(L,C,!0),_origin:A(new h),origin:l(H,B,!0),rotation:l(e,c,!0),scale:l(void 0,F),scaleX:l(p,o,!0),scaleY:l(w,x,!0),x:l(t,v,!0),y:l(P,r,!0)})}var l=j.descriptorAccessor,
A=j.descriptorData,s=j.getter,E=1,K=Math.atan2,y=Math.sqrt,D=Math.PI,L=s("_opacity"),s=M.prototype={parent:null,type:"DisplayObject",attr:function(a,b){var c,d,e=this._attributes;switch(arguments.length){case 0:c={};for(d in e)"_"!==d.charAt(0)&&(c[d]=e[d]);return c;case 1:if("string"===typeof a)return a in e&&"_"!==a.charAt(0)?e[a]:void 0;for(d in a)d in e&&"_"!==d.charAt(0)&&(e[d]=a[d]);this.markUpdate();return this;case 2:return a in e&&"_"!==a.charAt(0)&&(e[a]=b),this.markUpdate(),this}},destroy:function(){return this.removeAllListeners().remove()},
filters:function(){},mask:function(){},blendMode:function(){},markUpdate:function(){this.parent&&(b.needsDraw[this.id]=this)},remove:function(){var a=this.parent;a&&a.removeChild(this);return this},setOrigin:function(a,b){return this.attr("origin",{x:a,y:b})},composeRenderMessage:function(){var a={};a.attributes=this.attr();a.type=this.type;a.data=this._getRenderData();a.index=this.parent.getIndexOfChild(this);a.parentId=this.parent.id;return a},animate:function(a,b,c){var d=a;if(!(d instanceof g||
d instanceof k)){c||(c={});if(c.from&&!c.clock){for(d=this;!d.advance;d=d.parent);c.clock=d}d=new g(a,b,c)}d.play(this);return this},_getRenderData:function(){return null}};j.mixin(s,a);return M});define("movie",["./display_object","./display_list","./timeline","./tools"],function(a,j,b,f){function h(){a.call(this);this._children=[]}h.prototype=f.mixin(Object.create(a.prototype),b,j);return h});
define("shape","./point,./curve,./segment_helper,./display_object,./tools,./color".split(","),function(a,j,b,f,h,g){function k(a){this._fill=x(a,this._fill)}function e(){return(this._fill&255)/255}function c(a){this._fill=(this._fill&4294967040|255*(1<a?1:0>a?0:a))>>>0}function d(a){this._line=x(a,this._line)}function i(a){if("butt"===a||"round"===a||"square"===a)this._cap=""+a}function t(a){if("miter"===a||"round"===a||"bevel"===a)this._join=""+a}function v(a){if(1<=a)this._miterLimit=+a}function P(){return(this._line&
255)/255}function r(a){this._line=(this._line&4294967040|255*(1<a?1:0>a?0:a))>>>0}var p,o=h.descriptorAccessor,w=h.descriptorData,h=h.getter,x=g,F=b.validTokens,C=b.parsePath,H=b.exportToPath,B=b.parseCommandList,M=[].slice,l=Math.sin,A=Math.cos,s=Math.PI,E=2*s,K=h("_fill"),y=h("_line"),D=h("_cap"),L=h("_join"),N=h("_miterLimit");p=function(a){f.call(this);Object.defineProperties(this._attributes,{_cap:w("butt",!0),cap:o(D,i,!0),_fill:w(0,!0),fill:o(K,k,!0),fillOpacity:o(e,c,!0),_join:w("miter",!0),
join:o(L,t,!0),_line:w(255,!0),line:o(y,d,!0),lineOpacity:o(P,r,!0),lineWidth:w(0,!0,!0),_miterLimit:w(4,!0),miterLimit:o(N,v,!0)});this._segments=[];this._curves=[];this._hasMove=!1;if("undefined"===typeof a)return this;var b=a instanceof Array?a[0]instanceof Array?a[0][0]:a[0]:a;if(-1!==F.indexOf(b))return this.segments.apply(this,arguments);if("number"===typeof b)return this.points.apply(this,arguments);if("string"===typeof a)return this.path(a);throw Error("Invalid parameter: "+a);};b=p.prototype=
Object.create(f.prototype);b.insertAt=function(){throw Error("not implemented");};b.segments=function(a){if("undefined"===typeof a)return this._segments.slice().map(function(a){return a.slice()});if(a instanceof Array)this._segments=a[0]instanceof Array?B(a.toString().split(",")):B(a);else if("string"===typeof a)this._segments=B.call(null,arguments);else throw Error("invalid parameter "+a);this._hasMove=!0;this.markUpdate();return this};b.points=function(a){if("undefined"===typeof a)return this._segments.map(function(a){return a.slice(-2)}).filter(Boolean);
for(var a=a instanceof Array?a:M.call(arguments),b=0,c,d,e=a.length;b<e;b+=2)c=a[b],d=a[b+1],0===b?this.clear().moveTo(c,d):this.lineTo(c,d);this._hasMove=!0;this.markUpdate();return this};b.path=function(a){var b=this._segments;if("undefined"===typeof a)return H(b);if("string"===typeof a)return b.push.apply(b,C(a)),this._hasMove=!0,this.markUpdate(),this;throw Error("invalid parameter "+a);};b.moveTo=function(a,b){var a=this._validateNumber(a),b=this._validateNumber(b),c=this._segments;if("undefined"===
typeof c[0])this._hasMove=!0;c.push(["moveTo",a,b]);this.markUpdate();return this};b.moveBy=function(a,b){var a=this._validateNumber(a),b=this._validateNumber(b),c=this._segments;if("undefined"===typeof c[0])this._hasMove=!0;c.push(["moveBy",a,b]);this.markUpdate();return this};b.closePath=function(){this._ensureMoveSegment();this._segments.push(["closePath"]);this.markUpdate();return this};b.lineTo=function(a,b){this._ensureMoveSegment();a=this._validateNumber(a);b=this._validateNumber(b);this._segments.push(["lineTo",
a,b]);this.markUpdate();return this};b.lineBy=function(a,b){this._ensureMoveSegment();a=this._validateNumber(a);b=this._validateNumber(b);this._segments.push(["lineBy",a,b]);this.markUpdate();return this};b.verticalLineTo=function(a){this._ensureMoveSegment();return this.lineTo(this.lastPoint()[0],a)};b.verticalLineBy=function(a){this._ensureMoveSegment();return this.lineBy(0,a)};b.horizontalLineTo=function(a){this._ensureMoveSegment();var b=this.lastPoint();return this.lineTo(a,b[1])};b.horizontalLineBy=
function(a){this._ensureMoveSegment();return this.lineBy(a,0)};b.curveTo=function(a,b,c,d,e,g){this._ensureMoveSegment();if(6!==arguments.length)throw Error("curveTo: number of parameters is not valid.");this._segments.push(["curveTo",a,b,c,d,e,g]);this.markUpdate();return this};b.curveBy=function(a,b,c,d,e,g){this._ensureMoveSegment();if("undefined"===typeof g)throw Error("curveTo: number of parameters is not valid.");this._segments.push(["curveBy",a,b,c,d,e,g]);this.markUpdate();return this};b.throughCurveTo=
function(){throw Error("not implemented");};b.arcTo=function(a,b,c,d,e,g,i){this._ensureMoveSegment();this._segments.push(["arcTo",a,b,c,d,e,g,i]);this.markUpdate();return this};b.arcBy=function(a,b,c,d,e,g,i){this._ensureMoveSegment();this._segments.push(["arcBy",a,b,c,d,e,g,i]);this.markUpdate();return this};b.arc=function(a,b,c,d,e,g){"undefined"!==typeof this._segments[0]&&this.lineTo(a,b);var i;i=g?e:d;g=g?E-d:e;e=g-i;if(Math.abs(e)>=E)return this.moveTo(a+c,b).arcTo(c,c,0,1,1,a+c*A(E),b+c*l(E)-
1.0E-4);d=a+c*A(i);i=b+c*l(i);a+=c*A(g);b+=c*l(g);return this.moveTo(d,i).arcTo(c,c,0,e<s?0:1,1,a,b)};b.rect=function(a,b,c,d,e){if("undefined"!==typeof e)throw Error("radius not implemented");return this.moveTo(a,b).lineBy(0,d).lineBy(c,0).lineBy(0,-d).closePath()};b.getBoundingBox=function(){throw"Not implemented";};b.pointAtLength=function(){throw"Not implemented";};b.pathLength=function(){throw Error("not implemented");};b.isPointInPath=function(){throw Error("not implemented");};b.pathReverse=
function(){throw"Not implemented";};b.simplify=function(){throw Error("not implemented");};b.smooth=function(){throw Error("not implemented");};b.clear=function(){this._segments.length=0;return this};b.morphTo=function(){throw Error("not implemented");};b._toAbsolute=function(){var a=this._segments,b=a.length;if(0===b)return[["moveTo",0,0]];var c=[],d=0,e=0,g=0,i=0,f=0;"moveTo"==a[0][0]&&(d=a[0][1],e=a[0][2],g=d,i=e,f++,c[0]=["moveTo",d,e]);for(var k,h,j,l=f;l<b;l++){c.push(f=[]);k=a[l];j=k.length;
h=k[0];if(/By/.test(h))switch(f[0]=h.replace(/By/,"To"),h){case "arcBy":f[1]=k[1];f[2]=k[2];f[3]=k[3];f[4]=k[4];f[5]=k[5];f[6]=k[6]+d;f[7]=k[7]+e;break;case "verticalLineBy":f[1]=k[1]+e;break;case "horizontalLineBy":f[1]=k[1]+d;break;case "moveBy":g=k[1]+d,i=k[2]+e;default:for(h=1;h<j;h++)f[h]=k[h]+(h%2?d:e)}else for(h=0;h<j;h++)f[h]=k[h];switch(f[0]){case "closePath":d=g;e=i;break;case "horizontalLineTo":d=f[1];break;case "verticalLineTo":e=f[1];break;case "moveTo":g=f[f.length-2],i=f[f.length-1];
default:d=f[f.length-2],e=f[f.length-1]}}return c};b._toCurve=function(){throw Error("not implemented");};b._line2Curve=function(a,b,c,d){return[a,b,c,d,c,d]};b._quadratic2Curve=function(a,b,c,d,e,g){var i=1/3,f=2/3;return[i*a+f*c,i*b+f*d,i*e+f*c,i*g+f*d,e,g]};b._arc2Curve=function(a,b,c,d,e,g,i,f,k,h){var j=120*s/180,l=s/180*(+e||0),t=[],q,p=cacher(function(a,b,c){var d=a*math.cos(c)-b*math.sin(c),a=a*math.sin(c)+b*math.cos(c);return{x:d,y:a}});if(h)o=h[0],q=h[1],g=h[2],v=h[3];else{q=p(a,b,-l);a=
q.x;b=q.y;q=p(f,k,-l);f=q.x;k=q.y;math.cos(s/180*e);math.sin(s/180*e);q=(a-f)/2;o=(b-k)/2;v=q*q/(c*c)+o*o/(d*d);1<v&&(v=math.sqrt(v),c*=v,d*=v);var v=c*c,r=d*d,v=(g==i?-1:1)*math.sqrt(abs((v*r-v*o*o-r*q*q)/(v*o*o+r*q*q))),g=v*c*o/d+(a+f)/2,v=v*-d*q/c+(b+k)/2,o=math.asin(((b-v)/d).toFixed(9));q=math.asin(((k-v)/d).toFixed(9));o=a<g?s-o:o;q=f<g?s-q:q;0>o&&(o=2*s+o);0>q&&(q=2*s+q);i&&o>q&&(o-=2*s);!i&&q>o&&(q-=2*s)}if(abs(q-o)>j){var t=q,r=f,w=k;q=o+j*(i&&q>o?1:-1);f=g+c*math.cos(q);k=v+d*math.sin(q);
t=a2c(f,k,c,d,e,0,i,r,w,[q,t,g,v])}g=q-o;e=math.cos(o);j=math.sin(o);i=math.cos(q);q=math.sin(q);g=math.tan(g/4);c=4/3*c*g;g*=4/3*d;d=[a,b];a=[a+c*j,b-g*e];b=[f+c*q,k-g*i];f=[f,k];a[0]=2*d[0]-a[0];a[1]=2*d[1]-a[1];if(h)return[a,b,f][concat](t);t=[a,b,f][concat](t).join()[split](",");h=[];f=0;for(k=t.length;f<k;f++)h[f]=f%2?p(t[f-1],t[f],l).y:p(t[f],t[f+1],l).x;return h};b.lastSegment=function(){var a=this._segments.slice(-1);if("undefined"!==typeof a[0])return a;console.warn("No segments defined.")};
b.lastPoint=function(){var a,b,c,d,e,g,i,f=0,k=0,h=!1;a=this._segments.slice(-1)[0];if(/To/.test(a[0]))return a.slice(-2);for(g=this._segments,i=g.length;0<i--;){a=g[i];b=a[0];c=a.length;d=h?/moveTo/:/To/;e=h?/moveBy/:/By/;if(d.test(b))return[a[c-2]+f,a[c-1]+k];/close/.test(b)?h=!0:e.test(b)&&(f+=a[c-2],k+=a[c-1])}throw Error("Couldn't find a point.");};b._getCurves=function(){var a,b,c,d,e=this._curves;if("undefined"===typeof e[0]){a=this._toAbsolute();d=a.length-1;for(var g=0,i,f;g<d;g++)b=a[g],
c=b[0],f=a[g+1],"closePath"===f[0]&&(f=i),"moveTo"===c&&(i=c),e[g]=new j(b,f)}return e};b._ensureMoveSegment=function(){if(!1===this._hasMove)throw Error("You need at least a moveTo to add a horizontalLineBy.");return this};b._validatePoint=function(a,b){a=+a;b=+b;if(isNaN(a+b))throw Error("Parameters are not valid. Expecting x and y to be numbers. (x="+a+" ,y="+b+")");return[a,b]};b._validateNumber=function(a){a=+a;if(isNaN(a))throw Error("Parameters are not valid. Expecting a number.");return a};
b._validateBoolean=function(a){a=+a;if(0!==a||1!==a)throw Error("Parameters are not valid. Expecting boolean. (bool="+a+")");return a};b.type="Shape";b._getRenderData=function(){return this._segments.map(function(b){var c=[];b.forEach(function(b,d){switch(!0){case 0===d:c.push(b);break;case b instanceof a:c.push([b.x,b.y]);break;default:c.push(b)}});return c})};p.arc=function(a,b,c,d,e,g){return(new p).arc(a,b,c,d,e,g)};p.circle=function(a,b,c){return(new p).arc(a,b,c,0,E)};p.rect=function(a,b,c,
d,e){return(new p).rect(a,b,c,d,e)};return p});
define("bitmap",["./display_object","./asset_loading","./tools"],function(a,j,b){function f(b,f,e){a.call(this);this.source=b;this.type="bitmap";Object.defineProperties(this._attributes,{height:h(0,!0,!0),width:h(0,!0,!0)});e||(this.load(b,"img"),this.on("assetLoaded",function(a){this.attr({width:a.width,height:a.height});f.call(this,this)}))}var h=b.descriptorData,j=f.prototype=b.mixin(Object.create(a.prototype),j);j.composeRenderMessage=function(){var a={};a.attributes=this.attr();a.type=this.type;
a.data={source:this.source};a.index=this.parent.getIndexOfChild(this);a.parentId=this.parent.id;return a};j.clone=function(){var a=new f(this.source,null,!0);a.attr(this.attr());return a};return f});
define("group",["./display_object","./display_list","./tools","./registry"],function(a,j,b,f){function h(){a.call(this);this._children=[]}var g=h.prototype=Object.create(a.prototype);b.mixin(g,j);g.markUpdate=function(){this.parent&&(f.needsDraw[this.id]=this,this._children.forEach(function(a){b.hitch(a,"markUpdate")()},this))};g.type="group";return h});
define("sprite",["./bitmap","./group","./asset_loading","./tools"],function(a,j,b,f){function h(a,b){j.call(this);this.sources=a;this.callback=b;this.currentBitmapIndex=0;Object.defineProperties(this._attributes,{height:g(0,!0,!0),width:g(0,!0,!0)});this._load()}var g=f.descriptorData,b=h.prototype=Object.create(j.prototype);b._load=function(){for(var b=this.sources,e=0,c=b.length;e<c;++e)new a(b[e],f.hitch(this,"_bitmapLoaded"))};b._bitmapLoaded=function(a){this.addChild(a);this._children.length===
this.sources.length&&this.callback.call(this,this._children)};b.composeRenderMessage=function(){var a={},b=this._children[this.currentBitmapIndex];this._children.forEach(function(a){a.type="bitmap_hidden"});a.attributes=this.attr();a.attributes.height=b.attr("height");a.attributes.width=b.attr("width");a.type="bitmap";a.data={source:b.source};a.index=this.parent.getIndexOfChild(this);a.parentId=this.parent.id;return a};return h});
define("bikeshed","./stage,./movie,./point,./shape,./bitmap,./group,./animation,./keyframe_animation,./easing,./matrix,./sprite,./color".split(","),function(a,j,b,f,h,g,k,e,c,d,i,t){return{stage:a,Group:g,Movie:j,Point:b,Shape:f,Bitmap:h,Sprite:i,Animation:k,KeyframeAnimation:e,color:t,easing:c,Matrix:d}});
define("tree_helper",["./error","./tools"],function(a,j){var b=j.descriptorData,f=function(a){var b=a.parent;a===b.top&&(b.top=a.prev);a===b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)},h=function(a,f,e){return Object.create(null,{id:b(a,!1,!1,!1),message:b(f,!0,!1,!1),parent:b(e,!0,!1,!1),next:b(null,!0,!1,!1),prev:b(null,!0,!1,!1)})};return{newTree:function(){return Object.create(null,{"0":b(h("ROOT",null),!0,!1,!1)})},newItem:h,insertAfter:function(a,b){if(a===
b)throw Error("insertItem mustn't be equal to afterItem.");if(!("parent"in a))throw Error("insertItem must have a parent property.");var e=a.parent;(b=b||e.top)?(f(a),b===e.top&&(e.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a):(e.bottom=a,e.top=a)},tear:f}});
define("renderer",["./tree_helper","./tools","./event_emitter"],function(a,j,b){function f(){this._tree=g();this._waitingForParentId=null}var h=a.newItem,g=a.newTree,k=a.insertAfter,a=f.prototype={};a.stageController=null;a.render=function(a){if(!(a instanceof Array))throw Error("we only accept arrays atm.");var b=[];this._waitingForParentId=Object.create(null);for(var d=0,g,f=a.length;d<f;d++)g=a[d],b.push(g),this.parseMessage(g);b.forEach(function(a){a.attributes&&this.drawItem(a.id,a)},this)};
a.parseMessage=function(a){var b=this._tree,d=this._waitingForParentId,g,f;g=a.parentId;if("undefined"===typeof g)throw Error("Mandatory property parentId is missing.");if(g in b){var j=a.id;if("undefined"===typeof j)throw Error("Mandatory property id is missing.");f=a.type;if("undefined"===typeof f)throw Error("Mandatory property type is missing.");if("undefined"===typeof("group"===f))throw Error("Mandatory property isGroup is missing.");if("undefined"===typeof a.data)throw Error("Mandatory property data is missing.");
f=b[g];(g=b[j])?g.message=a:(g=this._tree[j]=h(j,a,f),k(g));if("afterId"in a){b=b[a.afterId];if(!b)throw Error("afterId is unknown.");k(g,a.after)}j in d&&d[j].forEach(this.parseMessage,this);if(1===Object.keys(a).length)this.removeObject(j);else return a}else g in d?d[g].push(a):d[g]=[a]};a._refreshStage=function(){var a=this;this.clearStage();(function d(b){for(var g,f,h;null!==b;)g=b.message,f=b.id,h=b.parent,"bottom"in b&&a.createGroup(f)&&d(b.bottom),g&&h&&a.drawItem(f,h.id,g),b=b.next;b&&b.prev&&
d(b.prev.parent.next)})(this._tree[0])};a.drawItem=function(a,b){var d="draw"+b.type;d in this&&this[d](a,b.data,b.attributes)};j.mixin(f.prototype,b);return f});
define("raphael_renderer",["./renderer","./tools","./segment_helper"],function(a,j,b){var f=b.exportToPath,h={cap:"stroke-linecap",fill:"fill",fillOpacity:"fill-opacity",join:"stroke-linejoin",line:"stroke",lineWidth:"stroke-width",lineOpacity:"stroke-opacity",matrix:"transform",miterLimit:"stroke-miterlimit",opacity:"opacity",x:"x",y:"y"},g=function(a){var b,e={},g;for(g in a)switch(b=a[g],g){case "line":case "fill":e[h[g]]="rgba("+[b>>>24,b>>16&255,b>>8&255,b&255]+")";break;case "matrix":e[h[g]]=
Raphael.matrix(b.a,b.b,b.c,b.d,b.tx,b.ty).toTransformString();break;case "x":case "y":break;default:e[h[g]]=b}return e},b=function(b,d){a.call(this);this._stage=Raphael(b,d.width,d.height);this.connectDOMElement(this._stage.canvas);document.addEventListener("keydown",j.hitch(this,function(a){this.emit("userevent",{id:0,type:"key",args:{keyCode:a.keyCode,ctrlKey:a.ctrlKey,altKey:a.altKey,metaKey:a.metaKey}})}))},k=a.prototype,e=b.prototype=Object.create(k);e.render=function(a){k.render.call(this,a)};
e.connectDOMElement=function(a){a.addEventListener("click",j.hitch(this,function(a){this.emit("userevent",{id:0,type:"click",args:{x:a.clientX,y:a.clientX}})}));a.addEventListener("mousedown",j.hitch(this,function(a){this.emit("userevent",{id:0,type:"down",args:{x:a.clientX,y:a.clientX}})}));a.addEventListener("mouseup",j.hitch(this,function(a){this.emit("userevent",{id:0,type:"up",args:{x:a.clientX,y:a.clientX}})}));a.addEventListener("touchstart",j.hitch(this,function(a){this.emit("userevent",{id:0,
type:"down",args:{x:a.touches[0].clientX,y:a.touches[0].clientX}})}));a.addEventListener("touchend",j.hitch(this,function(a){this.emit("userevent",{id:0,type:"up",args:{x:a.touches[0].clientX,y:a.touches[0].clientX}})}))};e.connectObject=function(a){a.click(j.hitch(this,function(b,e,g){this.emit("userevent",{id:a.id,type:"click",args:{x:e,y:g}})}));a.mousedown(j.hitch(this,function(b,e,g){this.emit("userevent",{id:a.id,type:"down",args:{x:e,y:g}})}));a.mouseup(j.hitch(this,function(b,e,g){this.emit("userevent",
{id:a.id,type:"up",args:{x:e,y:g}})}));a.touchstart(j.hitch(this,function(b,e,g){this.emit("userevent",{id:a.id,type:"down",args:{x:e,y:g}})}));a.touchend(j.hitch(this,function(b,e,g){this.emit("userevent",{id:a.id,type:"up",args:{x:e,y:g}})}));a.drag(j.hitch(this,function(b,e,g,f){this.emit("userevent",{id:a.id,type:"drag",args:{x:g,y:f,diffX:b,diffY:e}})}))};e.disconnectObject=function(a){a.unclick();a.unmousedown();a.unmouseup();a.untouchstart();a.untouchend();a.undrag()};e.drawShape=function(a,
b,e){var h=this._stage,k=h.getById(a);if(null===k)k=h.path(""),k.id=a,this.connectObject(k);k.attr({path:"M0,0"+f(b)}).attr(g(e))};e.drawBitmap=function(a,b,e){var f=this._stage,b=b.source,a=f.getById(a),a=f.image(b,0,0,e.width,e.height);a.attr(g(e))};e.createGroup=function(){return!0};e.clearStage=function(){this._stage.clear()};e.removeObject=function(a){a=this._stage.getById(a);if(null===a)throw Error("Unknown object.");a.remove()};e.changeOrder=function(){throw Error("not implemented");};return b});
define("stage_controller",["./tools","./event_emitter","require"],function(a,j,b){function f(g,f,e){var c=new Worker(b.toUrl(e.workerScript));Object.defineProperties(this,{_worker:{value:c},_renderer:{value:g},_assetController:{value:f}});f.on("assetLoaded",a.hitch(this,function(a){this.post("assetLoaded",a)}));g.on("userevent",a.hitch(this,function(a){this.post("userevent",a)}));c.addEventListener("message",a.hitch(this,function(a){this.handleEvent(a)}));e.assets?f.preload(e.assets,function(){c.postMessage(e)}):
c.postMessage(e)}var h=f.prototype={destroy:function(){this._worker.terminate();this._renderer.clearStage()},handleEvent:function(a){a=a.data;switch(a.command){case "render":this.currentFrame=a.frame;this._renderer.render(a.data);break;case "play":case "stop":this.emit(a.command,a.data);break;case "debug":console.log.apply(console,["WORKER DEBUG:"].concat(a.data));break;case "loadAsset":this._assetController.load(a.data)}},play:function(a){return this.post("play",a)},post:function(a,b){this._worker.postMessage({command:a,
data:b});return this},stop:function(a){return this.post("stop",a)}};a.mixin(h,j);return f});define("extensions",{png:"img",jpg:"img",jpeg:"img",gif:"img",bmp:"img",svg:"img",css:"text",json:"text",xml:"text",html:"text",txt:"text"});
define("asset_controller",["./extensions","./tools","./event_emitter"],function(a,j,b){function f(){this.assets={}}var h=f.handlers={img:function(a,b){var e=new Image;e.onload=function(){b(e,{width:e.width,height:e.height})};e.src=a;if(e.complete)e.onload(),e.onload=null},text:function(a,b){var e=new XMLHttpRequest;e.open("GET",a);e.send(null);e.onreadystagechange=function(){4===e.readyState&&200===e.status&&b(e.responseText,e.responseText)}}};f.prototype={load:function(a,b){var b=b||"assetLoaded",
e=a.source,c=a.type;if(c in h)h[c](a.source,j.hitch(this,function(c,f){this.assets[e]=c;this.emit(b,j.mixin(a,f))}));else throw Error("Type not found in AssetController.handlers: "+c);},preload:function(b,f){var b=b instanceof Array?b:[b],e=0,c,d,h=0,j=+new Date;this.on("_preloadedAssetLoaded",function(a){0===a.id.indexOf(j)&&h++;h===e&&f()});for(var v=0,P=b.length;v<P;++v)if(c=b[v],d=a[(c.match(/\.([a-z]+)$/i)||[,""])[1]])e++,this.load({source:c,type:d,id:j+"_"+v},"_preloadedAssetLoaded")}};j.mixin(f.prototype,
b);return f});
define("main_controller",["./raphael_renderer","./stage_controller","./asset_controller"],function(a,j,b){return{_workerScript:"kernel.js",load:function(f,h,g){var k=document.createElement("a");k.href=h;g.url=k.href;g.framerate=g.framerate||60;g.workerScript=g.workerScript||this._workerScript;f=new a(f,g);h=new b;return new j(f,h,g)},loadFromScript:function(f,h,g){g.script=h;g.framerate=g.framerate||60;g.workerScript=g.workerScript||this._workerScript;f=new a(f,g);h=new b;return new j(f,h,g)},_setWorkerLocation:function(a){this._workerScript=
a}}});
if("undefined"!==typeof importScripts){var debug=function(){postMessage({command:"debug",data:[].slice.call(arguments)})};addEventListener("message",function init(j){var b=j.data;if(b.noCache)this.require={urlArgs:+new Date};b.requirePath&&importScripts(b.requirePath);removeEventListener("message",init);require(["bikeshed"],function(f){this.bikeshed=f;if(b.script){var h=f.stage;addEventListener("message",h);h.init(b);Function("stage",b.script)(h)}else{var g=new XMLHttpRequest;g.open("GET",b.url);g.send("");
g.onload=function(){g=null;var h=f.stage;addEventListener("message",h);h.init(b);Function("stage",this.responseText)(h)}}})})}else define("kernel",["./main_controller","./bikeshed"],function(a){window.bikeshed=a;for(var j="bikeshed.js",b=document.getElementsByTagName("script"),f=0,h=b.length;f<h;f++)if(b[f].src&&0<b[f].src.indexOf("bikeshed.js"))j=b[f].src;a._setWorkerLocation(j)});
